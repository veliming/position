{"version":3,"sources":["webpack:///./pages/index/index.js"],"names":["app","getApp","Page","data","longitude","latitude","mapHeight","userLicenseAgreementDisplay","boxDisplay","repairFeedbackDisplay","hasUserInfo","disabled","canIUse","wx","cannotEntery","submitFeedback","userInfo","markers","iconPath","id","width","height","polyline","points","color","dottedLine","items","name","value","onReady","e","that","this","mapCtx","createMapContext","getLocation","type","success","res","setData","bindGetUserInfo","getSetting","authSetting","getUserInfo","setStorageSync","login","userInfoStr","getStorageSync","console","log","code","nicN","nickName","nicA","avatarUrl","errMsg","onLoad","globalData","userInfoReadyCallback","onShow","agreement","detail","toAgreement","navigateTo","url","agreemented","repair","checkboxChange","repairFeedbackBox"],"mappings":"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","file":"pages\\index\\index.js","sourcesContent":["//index.js\nconst app = getApp()\n\nPage({\n  \n  data: {\n    longitude: 113.324520,\n    latitude: 23.099994,\n    mapHeight:\"100vh\",\n\n    userLicenseAgreementDisplay:false,\n    boxDisplay:false,\n    repairFeedbackDisplay:false,\n    // boxDisplay:true,\n\n    hasUserInfo: false,\n    disabled: true,\n    canIUse: wx.canIUse('button.open-type.getUserInfo'),\n    cannotEntery: true,\n\n    submitFeedback:[],\n    userInfo: {},\n  \n    markers: [\n      {\n        iconPath: \"../img/mapMarker.png\",\n        id: 0,\n        latitude: 30.49984,\n        longitude: 114.34253,\n        width: 30,\n        height: 30\n      },\n      {\n        iconPath: \"../img/mapMarker.png\",\n        id: 0,\n        latitude: 30.489959,\n        longitude: 114.401657,\n        width: 30,\n        height: 30\n      },\n      {\n        iconPath: \"../img/mapMarker.png\",\n        id: 0,\n        latitude: 30.49514,\n        longitude: 114.402185,\n        width: 30,\n        height: 30\n      }\n    ],\n    // 路线\n    polyline: [{\n      points: [{\n        latitude: 30.49984,\n        longitude: 114.34253,\n      }, {\n          latitude: 30.489959,\n          longitude: 114.401657,\n      },{\n          latitude: 30.49514,\n          longitude: 114.402185,\n      }],\n      color: \"#FF0000DD\",\n      width: 2,\n      dottedLine: true\n    }],\n    // 故障反馈类型\n    items: [\n      { name: 'location', value: '校车的定位错误；定位与实际位置偏离', color:'red' },\n      { name: 'state', value: '校车颜色标示的状态与校车的实际状态不符', color: 'red'  },\n      { name: 'number', value: '校车车号不对应', color: 'red'  },\n      { name: 'path', value: '路线错误，上车点错误', color: 'red'  },\n    ]\n  },\n\n  onReady: function (e) {\n    // 使用 wx.createMapContext 获取 map 上下文\n    let that = this\n    this.mapCtx = wx.createMapContext('myMap')\n    wx.getLocation({\n      type: 'gcj02', //返回可以用于wx.openLocation的经纬度\n      success(res) {\n        const latitude = res.latitude\n        const longitude = res.longitude\n      that.setData({\n        latitude: latitude,\n        longitude: longitude,\n      })\n      }\n    }) \n\n    // wx.createSelectorQuery().select(\"#map\").boundingClientRect(function(rect) {\n    //   let top = rect.top\n    //   that.setData({\n    //     // mapHeight:wx.getSystemInfoSync().windowHeight-top\n    //     mapHeight:\n    //   })\n    //   console.log(that.data.mapHeight)\n    //   console.log(wx.getSystemInfoSync().windowHeight)\n    //   console.log(top)\n    // }).exec()\n  },  \n\n\n  bindGetUserInfo: function (e) {\n    // 查看是否授权\n    var that = this;\n\n    wx.getSetting({\n      success(res) {\n        if (res.authSetting['scope.userInfo']) {\n          wx.getUserInfo({\n            success: function (res) {\n              wx.setStorageSync(\"userInfoStr\", res.userInfo)\n              wx.login({\n                success(res) {\n                  var userInfoStr = wx.getStorageSync(\"userInfoStr\");\n                  console.log(userInfoStr)\n                  if (res.code) {\n                    //发起网络请求\n                    let nicN = userInfoStr.nickName,\n                      nicA = userInfoStr.avatarUrl,\n                      // authorizeUrl = app.BASE_URL + '/api/weapp/authorizations',\n                      authorizeData = { code: res.code, nickname: nicN, avatar: nicA }\n\n                    // app.request(authorizeUrl, 'POST', authorizeData, res => {\n                    //   wx.setStorageSync('token', res.data.access_token)   \n                    //   var token = wx.getStorageSync('token')\n                    // }, res => { }, { 'content-type': 'application/x-www-form-urlencoded' }, '')\n                  } else {\n                    console.log('登录失败！' + res.errMsg)\n                  }\n                }\n              })\n            }\n          })\n          wx.setStorageSync(\"userEnter\", true)\n          that.setData({\n            cannotEntery: false,\n            userLicenseAgreementDisplay: true,\n          })\n        } else {\n          console.log(\"用户拒绝登录\")\n        }\n      }\n    })\n  },\n\n  onLoad: function () {\n    if (app.globalData.userInfo) {\n      this.setData({\n        userInfo: app.globalData.userInfo,\n        hasUserInfo: true\n      })\n    } else if (this.data.canIUse){\n      // 由于 getUserInfo 是网络请求，可能会在 Page.onLoad 之后才返回\n      // 所以此处加入 callback 以防止这种情况\n      app.userInfoReadyCallback = res => {\n        this.setData({\n          userInfo: res.userInfo,\n          hasUserInfo: true\n        })\n      }\n    } else {\n      // 在没有 open-type=getUserInfo 版本的兼容处理\n      wx.getUserInfo({\n        success: res => {\n          app.globalData.userInfo = res.userInfo\n          this.setData({\n            userInfo: res.userInfo,\n            hasUserInfo: true\n          })\n        }\n      })\n    }\n  },\n  onShow: function (e) {\n    const agreement = wx.getStorageSync('agreement')\n    const userEnter = wx.getStorageSync('userEnter')\n    userEnter ? this.setData({ cannotEntery: false, userLicenseAgreementDisplay: true }) : this.setData({ cannotEntery: true, userLicenseAgreementDisplay: false })\n\n    if (agreement) {\n      this.setData({ userLicenseAgreementDisplay: false, boxDisplay: true })\n    }\n  },\n  getUserInfo: function(e) {\n    console.log(e)\n    app.globalData.userInfo = e.detail.userInfo\n    this.setData({\n      userInfo: e.detail.userInfo,\n      hasUserInfo: true\n    })\n  },\n  // 查看用户许可协议详细内容（跳转\n  toAgreement:function(e){\n    wx.navigateTo({\n      url:'../agreement/agreement'\n    })\n  },\n  // 同意用户许可协议后不再显示用户许可协议面板\n  agreemented:function(e){\n    wx.setStorageSync('agreement', true)\n   this.setData({\n     userLicenseAgreementDisplay: false,\n     boxDisplay: true,\n   })\n  },\n// 故障反馈面板是否显示\n  repair:function(){\n    this.setData({\n      boxDisplay: false,\n      repairFeedbackDisplay: true,\n    })\n  },\n  // 获取checkbox的值\n  checkboxChange: function (e) {\n    console.log('checkbox发生change事件，携带value值为：', e.detail.value)\n    this.setData({\n      submitFeedback: e.detail.value\n    })\n  },\n  // 提交反馈\n  submitFeedback:function(e){\n    console.log(this.data.submitFeedback)\n  },\n  repairFeedbackBox:function(){\n    this.setData({\n      repairFeedbackDisplay: false,\n      boxDisplay: true,\n    })\n  }\n})\n"],"sourceRoot":""}